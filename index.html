<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CompileRace</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
</head>
<body>

<div class="app-header">
  <div class="header-controls">
  <input type="color" id="colorPicker" />
  <button class="customize-btn" id="customizeBtn">ğŸ¨ Customize</button>
</div>

  <h1 class="logo">Compile<span>Race</span></h1>
  
  <span class="header-badge">âš¡ Java Speed Coding</span>
</div>

<div class="home-wrap">
  <div class="home-card">
    <div class="home-hero">
      <h2>Pick a Challenge</h2>
      <p class="muted">Write Java as fast as you can. All tests must pass. Beat your best time.</p>
    </div>

    <div class="filter-bar">
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="Easy">ğŸŸ¢ Easy</button>
      <button class="filter-btn" data-filter="Medium">ğŸŸ¡ Medium</button>
      <button class="filter-btn" data-filter="Hard">ğŸ”´ Hard</button>
    </div>

    <div class="slider-wrap">
      <button class="slider-btn left" id="slideLeft" aria-label="Scroll left">â€¹</button>
      <div class="slider" id="challengeSlider"></div>
      <button class="slider-btn right" id="slideRight" aria-label="Scroll right">â€º</button>
    </div>

    <div class="home-footer">
      <span class="muted">Tip: Press <kbd>Ctrl+Enter</kbd> to submit.</span>
      <span class="muted" id="questionCount"></span>
    </div>
  </div>
</div>

<script src="questions.js"></script>
<script>
  // Accent color persistence (Home + Race)
  (function initAccentColor() {
    const saved = localStorage.getItem("compileRaceAccent");
    if (saved) {
      document.documentElement.style.setProperty("--accent", saved);
      document.documentElement.style.setProperty("--accent-glow", saved + "44");
    }

    const picker = document.getElementById("colorPicker");
    const btn = document.getElementById("customizeBtn");
    if (!picker) return;

    picker.value = saved || "#4ade80";

    picker.addEventListener("input", (e) => {
      const c = e.target.value;
      document.documentElement.style.setProperty("--accent", c);
      document.documentElement.style.setProperty("--accent-glow", c + "44");
      localStorage.setItem("compileRaceAccent", c);
    });

    if (btn) btn.addEventListener("click", () => picker.click());
  })();
</script>

<script>
  const slider = document.getElementById("challengeSlider");
  const leftBtn = document.getElementById("slideLeft");
  const rightBtn = document.getElementById("slideRight");
  const countEl = document.getElementById("questionCount");
  const all = window.QUESTIONS || [];

  function getBestTime(id) {
    const v = localStorage.getItem(`compileRaceBestTime::${id}`);
    return v ? parseInt(v, 10) : null;
  }

  function renderSlider(filter = "all") {
    const filtered = filter === "all" ? all : all.filter(q => q.difficulty === filter);
    countEl.textContent = `${filtered.length} challenge${filtered.length !== 1 ? "s" : ""}`;
    slider.innerHTML = "";

    if (!filtered.length) {
      slider.innerHTML = `<div class="empty-state">No challenges yet for this difficulty.</div>`;
      return;
    }

    filtered.forEach((q) => {
      const originalIdx = all.indexOf(q);
      const diff = q.difficulty || "Easy";
      const best = getBestTime(q.id);
      const a = document.createElement("a");
      a.className = "challenge-card";
      a.href = `race.html?q=${originalIdx}`;
      a.innerHTML = `
        <div class="card-top">
          <div class="cc-title">${q.title}</div>
          <div class="pill pill-${diff.toLowerCase()}">${diff}</div>
        </div>
        <div class="cc-sub">${q.objective}</div>
        <div class="cc-footer">
          <div class="cc-best ${best ? '' : 'cc-best-empty'}">${best ? `ğŸ† Best: ${best}s` : 'Not attempted'}</div>
          <div class="cc-cta">Start â†’</div>
        </div>
      `;
      slider.appendChild(a);
    });
  }

  function scrollByCards(dir) {
    const card = slider.querySelector(".challenge-card");
    if (!card) return;
    slider.scrollBy({ left: dir * (card.getBoundingClientRect().width + 14), behavior: "smooth" });
  }

  leftBtn.addEventListener("click", () => scrollByCards(-1));
  rightBtn.addEventListener("click", () => scrollByCards(1));

  document.querySelectorAll(".filter-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      renderSlider(btn.dataset.filter);
    });
  });

  renderSlider();
</script>
</body>
</html>